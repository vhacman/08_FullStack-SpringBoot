<!-- Card di una singola prenotazione, divisa in 3 colonne tramite CSS grid.
     [class]="booking().status.toLowerCase()" applica dinamicamente la classe
     CSS corrispondente allo stato (es. "pending", "checked_in") per colorare il testo. -->
<div class="booking-card">
  <div class="booking-grid">

    <!-- COLONNA 1: Dati ospite con toggle privacy al click -->
    <div class="col-guest">
      <div class="guest-name">
        <i class="bi bi-person-fill guest-icon"></i>
        {{ booking().guest.firstName }} {{ booking().guest.lastName }}
      </div>

      <!-- (click) chiama il metodo nel .ts che inverte il Signal ssnVisible.
           @if nel template verifica il valore del Signal e mostra/nasconde il testo. -->
      <div class="guest-detail" (click)="toggleSsn()" style="cursor:pointer">
        @if (ssnVisible()) {
          {{ booking().guest.ssn }}
        } @else {
          Codice Fiscale
        }
      </div>

      <div class="guest-detail" (click)="toggleAddress()" style="cursor:pointer">
        @if (addressVisible()) {
          {{ booking().guest.address }}, {{ booking().guest.city }}
        } @else {
          Indirizzo
        }
      </div>
    </div>

    <!-- COLONNA 2: Info prenotazione -->
    <div class="col-booking">
      <div class="info-row">
        <span class="info-label">Camera</span>
        <span class="info-value">{{ booking().room.name }}</span>
      </div>
      <div class="info-row">
        <span class="info-label">Check-in</span>
        <!-- | date è una pipe Angular: formatta la data senza scrivere codice -->
        <span class="info-value">{{ booking().checkIn | date:'dd/MM/yy' }}</span>
      </div>
      <div class="info-row">
        <span class="info-label">Stato</span>
        <span class="info-value status-text" [class]="booking().status.toLowerCase()">
          {{ getStatusText(booking().status) }}
        </span>
      </div>
      <div class="info-row">
        <span class="info-label">Check-out</span>
        <span class="info-value">{{ booking().checkOut | date:'dd/MM/yy' }}</span>
      </div>
    </div>

    <!-- COLONNA 3: Pulsanti di azione contestuali.
         Ogni @if verifica lo stato della prenotazione e mostra solo il pulsante
         appropriato: questo rispecchia la macchina a stati definita nel backend. -->
    <div class="col-actions">

      @if (booking().status === 'PENDING') {
        <button class="btn-modern btn-checkin" (click)="acceptBooking()" title="Check-in">
          <i class="bi bi-box-arrow-in-right"></i>
        </button>
      }

      @if (booking().status === 'CHECKED_IN') {
        <!-- Il checkout è disponibile solo dal giorno di partenza in poi,
             non prima: isFuture blocca il pulsante finché non è il momento. -->
        @if (isFuture(booking().checkOut)) {
          <span class="status-badge done">Ospite presente</span>
        }
        @if (isToday(booking().checkOut) || isPast(booking().checkOut)) {
          <button class="btn-modern btn-checkout" (click)="checkout()" title="Check-out">
            <i class="bi bi-box-arrow-left"></i>
          </button>
        }
      }

      @if (booking().status === 'CHECKED_OUT') {
        <button class="btn-modern btn-clean" (click)="complete()" title="Pulizie eseguite">
          <i class="bi bi-stars"></i>
        </button>
      }

      @if (booking().status === 'COMPLETE') {
        <span class="status-badge success">Disponibile</span>
      }

    </div>

  </div>
</div>
