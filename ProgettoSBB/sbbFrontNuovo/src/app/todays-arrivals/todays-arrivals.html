<div class="w3-container w3-padding-large">

  <!-- Intestazione -->
  <div class="arrivals-header-box">
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;">
      <h2 class="page-title" style="margin: 0;">
        <i class="fa fa-calendar-check-o"></i> Arrivi di Oggi
      </h2>
      <button class="refresh-btn" (click)="refresh()" title="Aggiorna">
        <img src="img/iconaRefresh.png" alt="Aggiorna">
      </button>
    </div>
  </div>

  <!-- Stato vuoto -->
  @if (bookings().length === 0 && checkedInBookings().length === 0) {
    <div class="w3-panel w3-leftbar w3-padding-16 empty-state">
      <p><i class="fa fa-info-circle"></i> Nessun arrivo previsto per oggi.</p>
    </div>
  }

  <!-- Lista Arrivi in attesa di check-in -->
  @if (bookings().length > 0) {
    <div class="bookings-list">
      @for (booking of bookings(); track booking.id) {
        <app-booking-row [booking]="booking" (checkInDone)="onCheckInDone($event)"></app-booking-row>
      }
    </div>
  }

  <!-- Sezione Checked In collassabile -->
  @if (checkedInBookings().length > 0) {
    <div class="collapsible-section">

      <div class="collapsible-header green" (click)="toggleCheckedIn()">
        <i class="fa fa-check-circle"></i>
        <span>Checked In</span>
        <span class="count-badge green-badge">{{ checkedInBookings().length }}</span>
        <i class="fa chevron" [class.fa-chevron-down]="!checkedInExpanded()" [class.fa-chevron-up]="checkedInExpanded()"></i>
      </div>

      @if (!checkedInExpanded()) {
        <!-- Collapsed: chip con i nomi -->
        <div class="chips-container">
          @for (b of checkedInBookings(); track b.id) {
            <span class="guest-chip">
              <i class="fa fa-user"></i>
              {{ b.guest.firstName }} {{ b.guest.lastName }}
              <span class="chip-room">Â· {{ b.room.name }}</span>
            </span>
          }
        </div>
      } @else {
        <!-- Expanded: card complete -->
        <div class="expanded-list">
          @for (b of checkedInBookings(); track b.id) {
            <app-booking-row [booking]="b"></app-booking-row>
          }
        </div>
      }

    </div>
  }

</div>
