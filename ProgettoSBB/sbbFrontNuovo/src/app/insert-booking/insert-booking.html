<div class="w3-container w3-padding-large">

  <div class="booking-header-box">
    <div style="display:flex; align-items:center; gap:12px;">
      <i class="bi bi-calendar-plus header-icon"></i>
      <h2 class="page-title" style="margin:0;">Nuova Prenotazione</h2>
    </div>
  </div>

  <form class="booking-form" #bookingForm="ngForm" (ngSubmit)="submit()">

    <app-guest-picker
      (guestSelected)="onGuestSelected($event)"
      (guestNotFound)="onGuestNotFound($event)">
    </app-guest-picker>

    @if (showInsertGuest()) {
      <app-insert-guest (guestCreated)="onGuestCreated($event)"></app-insert-guest>
    } @else {

      @if (guestSelected()) {
        <div class="form-row">
          <div class="form-group">
            <label>Check-in</label>
            <input type="date"
                   [min]="today"
                   [value]="checkIn()"
                   (change)="onCheckInChange($any($event.target).value)"
                   class="form-input">
          </div>
          <div class="form-group">
            <label>Check-out</label>
            <input type="date"
                   [min]="minCheckOut()"
                   [value]="checkOut()"
                   (change)="onCheckOutChange($any($event.target).value)"
                   class="form-input">
          </div>
        </div>

        @if (nights() > 0) {
          <div class="msg-info">
            {{ nights() }} nott{{ nights() === 1 ? 'e' : 'i' }}
          </div>

          <app-room-picker
            [checkIn]="checkIn()"
            [checkOut]="checkOut()"
            (roomSelected)="onRoomSelected($event)">
          </app-room-picker>
        }
      }

      @if (selectedRoom()) {
        <div class="form-group">
          <label>Prezzo (€)</label>
          <input type="number" name="price" [ngModel]="price()" (ngModelChange)="price.set($event)" required min="0" class="form-input">
        </div>

        <div class="total-cost">
          TOTAL: {{ totalCost() }} €
        </div>

        <div class="form-group">
          <label>Note</label>
          <textarea name="notes" [(ngModel)]="form.notes" rows="2"
                    placeholder="Opzionale..." class="form-input"></textarea>
        </div>

        @if (success()) {
          <div class="msg-success">Prenotazione salvata con successo!</div>
        }
        @if (errorMessage()) {
          <div class="msg-error">{{ errorMessage() }}</div>
        }

        <div class="form-actions">
          <button type="submit" class="btn-submit"
                  [disabled]="!guestSelected() || form.roomId === 0">
            Salva
          </button>
          <button type="button" class="btn-reset" (click)="reset()">Reset</button>
        </div>
      }
    }
  </form>
</div>
